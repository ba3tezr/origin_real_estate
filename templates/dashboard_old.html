{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Statistics Cards -->
<div class="row g-4 mb-4">
    <!-- Total Properties -->
    <div class="col-md-3">
        <div class="stats-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="text-secondary mb-1">Total Properties</p>
                    <h2 class="mb-0 fw-bold">{{ total_properties }}</h2>
                    <small class="text-success"><i class="fas fa-arrow-up"></i> Active</small>
                </div>
                <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                    <i class="fas fa-building fa-2x text-primary"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Active Contracts -->
    <div class="col-md-3">
        <div class="stats-card success">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="text-secondary mb-1">Active Contracts</p>
                    <h2 class="mb-0 fw-bold">{{ active_contracts }}</h2>
                    <small class="text-muted">of {{ total_contracts }} total</small>
                </div>
                <div class="rounded-circle bg-success bg-opacity-10 p-3">
                    <i class="fas fa-file-contract fa-2x text-success"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pending Maintenance -->
    <div class="col-md-3">
        <div class="stats-card warning">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="text-secondary mb-1">Maintenance</p>
                    <h2 class="mb-0 fw-bold">{{ pending_maintenance }}</h2>
                    <small class="text-warning"><i class="fas fa-clock"></i> Pending</small>
                </div>
                <div class="rounded-circle bg-warning bg-opacity-10 p-3">
                    <i class="fas fa-tools fa-2x text-warning"></i>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Total Clients -->
    <div class="col-md-3">
        <div class="stats-card danger">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="text-secondary mb-1">Clients</p>
                    <h2 class="mb-0 fw-bold">{{ total_clients }}</h2>
                    <small class="text-muted">Active tenants</small>
                </div>
                <div class="rounded-circle bg-info bg-opacity-10 p-3">
                    <i class="fas fa-users fa-2x text-info"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row g-4 mb-4">
    <!-- Properties Chart -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Properties by Type</h5>
                <span class="badge bg-primary">Live Data</span>
            </div>
            <div class="card-body">
                <canvas id="propertiesChart" height="100"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Quick Stats</h5>
            </div>
            <div class="card-body">
                <div class="mb-3 pb-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Available Properties</span>
                        <span class="badge bg-success">{{ available_properties }}</span>
                    </div>
                </div>
                <div class="mb-3 pb-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Rented Properties</span>
                        <span class="badge bg-info">{{ rented_properties }}</span>
                    </div>
                </div>
                <div class="mb-3 pb-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>In Progress Maintenance</span>
                        <span class="badge bg-warning">{{ in_progress_maintenance }}</span>
                    </div>
                </div>
                <div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Total Owners</span>
                        <span class="badge bg-secondary">{{ total_owners }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activities -->
<div class="row g-4">
    <!-- Recent Contracts -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>Recent Contracts</h5>
                <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body">
                {% if recent_contracts %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>Client</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for contract in recent_contracts %}
                                <tr>
                                    <td>{{ contract.property.code }}</td>
                                    <td>{{ contract.client.name }}</td>
                                    <td><span class="badge badge-{{ contract.status }}">{{ contract.get_status_display }}</span></td>
                                    <td>{{ contract.created_at|date:"Y-m-d" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-inbox fa-3x mb-3"></i>
                        <p>No recent contracts</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Maintenance -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-wrench me-2"></i>Recent Maintenance</h5>
                <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body">
                {% if recent_maintenance %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Request #</th>
                                    <th>Property</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for maintenance in recent_maintenance %}
                                <tr>
                                    <td>{{ maintenance.request_number }}</td>
                                    <td>{{ maintenance.property.code }}</td>
                                    <td><span class="badge badge-{{ maintenance.priority }}">{{ maintenance.get_priority_display }}</span></td>
                                    <td><span class="badge badge-{{ maintenance.status }}">{{ maintenance.get_status_display }}</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="text-center py-4 text-muted">
                        <i class="fas fa-inbox fa-3x mb-3"></i>
                        <p>No recent maintenance requests</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
    // Properties Chart
    const ctx = document.getElementById('propertiesChart');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ chart_labels|safe }},
            datasets: [{
                label: 'Properties',
                data: {{ chart_data|safe }},
                backgroundColor: [
                    'rgba(30, 58, 138, 0.8)',
                    'rgba(59, 130, 246, 0.8)',
                    'rgba(75, 85, 99, 0.8)',
                    'rgba(16, 185, 129, 0.8)',
                    'rgba(245, 158, 11, 0.8)',
                ],
                borderColor: [
                    'rgba(30, 58, 138, 1)',
                    'rgba(59, 130, 246, 1)',
                    'rgba(75, 85, 99, 1)',
                    'rgba(16, 185, 129, 1)',
                    'rgba(245, 158, 11, 1)',
                ],
                borderWidth: 2,
                borderRadius: 5,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
</script>
{% endblock %}
