{% extends 'base.html' %}
{% load static %}

{% block title %}Financial Management Â· Origin App{% endblock %}
{% block page_title %}<i class="fas fa-chart-line me-2"></i>Financial Management{% endblock %}

{% block content %}
<!-- KPI Cards -->
<div class="row g-3 mb-4">
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-success bg-opacity-10 rounded p-3">
                            <i class="fas fa-arrow-up fa-2x text-success"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Total Revenue (30d)</h6>
                        <h3 class="mb-0 text-success">${{ total_revenue|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-danger bg-opacity-10 rounded p-3">
                            <i class="fas fa-arrow-down fa-2x text-danger"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Total Expenses (30d)</h6>
                        <h3 class="mb-0 text-danger">${{ total_expenses|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-primary bg-opacity-10 rounded p-3">
                            <i class="fas fa-chart-pie fa-2x text-primary"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Net Income (30d)</h6>
                        <h3 class="mb-0 {% if net_income >= 0 %}text-success{% else %}text-danger{% endif %}">
                            ${{ net_income|floatformat:2 }}
                        </h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-info bg-opacity-10 rounded p-3">
                            <i class="fas fa-wallet fa-2x text-info"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Cash Balance</h6>
                        <h3 class="mb-0">${{ cash_balance|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row g-3 mb-4">
    <div class="col-md-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-md-2 col-sm-4">
                        <a href="{% url 'financial:invoice_create' %}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-file-invoice me-2"></i>New Invoice
                        </a>
                    </div>
                    <div class="col-md-2 col-sm-4">
                        <a href="{% url 'financial:payment_create' %}" class="btn btn-outline-success w-100">
                            <i class="fas fa-money-bill me-2"></i>Receipt Voucher
                        </a>
                    </div>
                    <div class="col-md-2 col-sm-4">
                        <a href="{% url 'financial:journal_entry_create' %}" class="btn btn-outline-info w-100">
                            <i class="fas fa-book me-2"></i>Journal Entry
                        </a>
                    </div>
                    <div class="col-md-2 col-sm-4">
                        <a href="{% url 'financial:account_list' %}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-sitemap me-2"></i>Accounts
                        </a>
                    </div>
                    <div class="col-md-2 col-sm-4">
                        <a href="{% url 'financial:report_profit_loss' %}" class="btn btn-outline-warning w-100">
                            <i class="fas fa-chart-line me-2"></i>P&L Report
                        </a>
                    </div>
                    <div class="col-md-2 col-sm-4">
                        <a href="{% url 'financial:report_balance_sheet' %}" class="btn btn-outline-danger w-100">
                            <i class="fas fa-balance-scale me-2"></i>Balance Sheet
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-6">
        <!-- Recent Journal Entries -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-book me-2"></i>Recent Journal Entries</h5>
                <a href="{% url 'financial:journal_entry_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                {% if recent_entries %}
                    <div class="list-group list-group-flush">
                        {% for entry in recent_entries %}
                        <a href="{% url 'financial:journal_entry_detail' entry.pk %}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>{{ entry.entry_number }}</strong>
                                    <div class="text-muted small">{{ entry.description|truncatewords:10 }}</div>
                                </div>
                                <div class="text-end">
                                    <div>{{ entry.entry_date }}</div>
                                    <span class="badge {% if entry.is_posted %}bg-success{% else %}bg-warning{% endif %}">
                                        {% if entry.is_posted %}Posted{% else %}Draft{% endif %}
                                    </span>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">No recent entries</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Outstanding Invoices -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-file-invoice-dollar me-2"></i>Outstanding Invoices</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <span>Total Outstanding</span>
                    <h4 class="mb-0">${{ outstanding_invoices|floatformat:2 }}</h4>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-danger">Overdue Invoices</span>
                    <h5 class="mb-0 text-danger">{{ overdue_invoices }}</h5>
                </div>
                <a href="{% url 'financial:invoice_list' %}?status=issued" class="btn btn-sm btn-primary w-100 mt-3">View All Invoices</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <!-- Recent Invoices -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-file-invoice me-2"></i>Recent Invoices</h5>
                <a href="{% url 'financial:invoice_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                {% if recent_invoices %}
                    <div class="list-group list-group-flush">
                        {% for invoice in recent_invoices %}
                        <a href="{% url 'financial:invoice_detail' invoice.pk %}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>{{ invoice.invoice_number }}</strong>
                                    <div class="text-muted small">{{ invoice.get_invoice_type_display }}</div>
                                </div>
                                <div class="text-end">
                                    <div>${{ invoice.total_amount|floatformat:2 }}</div>
                                    <span class="badge bg-{{ invoice.status }}">{{ invoice.get_status_display }}</span>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">No recent invoices</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Recent Payments -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-money-check me-2"></i>Recent Payments</h5>
                <a href="{% url 'financial:payment_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                {% if recent_payments %}
                    <div class="list-group list-group-flush">
                        {% for payment in recent_payments %}
                        <a href="{% url 'financial:payment_detail' payment.pk %}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>{{ payment.payment_number }}</strong>
                                    <div class="text-muted small">{{ payment.get_payment_method_display }}</div>
                                </div>
                                <div class="text-end">
                                    <div class="{% if payment.payment_type == 'receipt' %}text-success{% else %}text-danger{% endif %}">
                                        ${{ payment.amount|floatformat:2 }}
                                    </div>
                                    <small class="text-muted">{{ payment.payment_date }}</small>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">No recent payments</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
